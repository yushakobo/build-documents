# Primer16 ビルドガイド

![completed_assembly_Front](imgs/Completed_assembly_Front.JPG)
![completed_assembly_Back](imgs/Completed_assembly_Back.JPG)

Primer16のお買い上げありがとうございます。

**実際の組み立てを始める前に、このビルドガイドを最後までお読みください。**

組み立ては本手順に沿って行ってください。  
本手順に疑問等がある場合は遊舎工房の[サポートページ](https://yushakobo.zendesk.com/hc/ja)を参照の上、お気軽にお問い合わせください。

## 注意事項

本キットの組み立てにはニッパーなどの刃物やハンダごてなどの火傷の危険性がある道具を使用しますので、十分に注意して作業を行ってください。  
キットの部品には細かい部品も含まれますので、保管する際はお子様などの手に届かない場所に保管してください。  
作業中に出るゴミ、切ったダイオードの足やピンヘッダの足などが刺さったりしますので、適宜清掃をしながら作業されることをお勧めします。

**本ガイド内の写真は一部Primer79のものを流用しています。**  
**適宜読み替えてください。**

## １．キットに同梱されている部品をチェックする

まずはキットに同梱されている部品が足りているかチェックしてください。  
万が一部品に不足がある場合は、大変お手数ですが遊舎工房の[お問い合わせフォーム](https://yushakobo.zendesk.com/hc/ja/requests/new)のカテゴリ **「購入した商品の不足・初期不良等」** を選択してお問い合わせください。

|名称|数量|画像|備考|
|---|---|---|---|
|基板|1|![PCB](imgs/PCB.JPG)|
|スルーホールダイオード|18|![Diode](imgs/Diode.JPG)|表面実装タイプにも対応（別途購入）|
|ProMicro|1|![ProMicro](imgs/ProMicro.jpg)|
|13ピンソケット|2|![Pinsocket](imgs/Pinsocket.JPG)|
|リセットスイッチ|1|![ResetSwitch](imgs/ResetSwitch.jpg)|
|ゴム足|4|![Cushion](imgs/Cushion.jpg)|

### １－１．オプション部品（ロータリーエンコーダ）

|名称|数量|画像|備考|
|---|---|---|---|
|ロータリーエンコーダ|2|![Encoder](imgs/Encoder.jpg)|ご購入は[こちら](https://shop.yushakobo.jp/products/3762)<br>プッシュスイッチ付きのものにも対応|
|ノブ|2|![Knob](imgs/Knob.jpg)|ご購入は[こちら](https://shop.yushakobo.jp/products/3730)<br>直径25mm以下のもの|

### １－２．オプション部品（アクリルケース）

|名称|数量|備考|
|---|---|---|
|アクリルプレート（5mm）|１式|[キーボードアクリルプレート](https://shop.yushakobo.jp/products/keyboard_acrylic_plate)にて購入してください|
|アクリルプレート（3mm）|１式|[キーボードアクリルプレート](https://shop.yushakobo.jp/products/keyboard_acrylic_plate)にて購入してください|
|ネジ（5mm）|5|
|ネジ（10mm）|3|
|ネジ（12mm）|2|
|キャップボルト（18mm）|6|
|スペーサー（4.5mm）|8|

### １－３．オプション部品（無線用部品）

|名称|数量|備考|
|---|---|---|
|BLE Micro Pro|1|ご購入は[こちら](https://shop.yushakobo.jp/products/ble-micro-pro)|
|BLE Micro Pro用電池基板|1|ご購入は[こちら](https://shop.yushakobo.jp/products/ble-micro-pro-battery-board)|
|コイン電池|2|CR1632を購入してください|

## ２．別途準備するパーツをチェックする

キットには含まれていないパーツは別途用意する必要があります。
予め購入し、組立前に不足がないかチェックしてください。

|名称|数量|備考|
|---|---|---|
|キースイッチ|16|ご購入は[こちら](https://shop.yushakobo.jp/collections/all-switches/cherry-mx-%E4%BA%92%E6%8F%9B-%E3%82%B9%E3%82%A4%E3%83%83%E3%83%81)<br>CherryMX互換スイッチのみ対応|
|キーキャップ|16|ご購入は[こちら](https://shop.yushakobo.jp/collections/keycaps/cherry-mx-%E4%BA%92%E6%8F%9B-%E3%82%AD%E3%83%BC%E3%82%AD%E3%83%A3%E3%83%83%E3%83%97)<br>キーレイアウトとキーキャップセットをよくチェックして購入してください|

## 必要な道具

|名称|備考|
|---|---|
|ハンダごて|できるだけ温度調節機能付きのもの|
|ハンダ線|0.6mm~0.8mm径程度のもの|
|ニッパー|
|ピンセット|スイッチの導通チェック用（代用可）|
|ドライバー|アクリルケースオプションの際に必要です。|

**こちらに[工具セット](https://shop.yushakobo.jp/products/a9900to)の用意もありますので、よろしければ部品と一緒にどうぞ。**

## 組み立ての手順

1. ダイオードのハンダ付け
1. ProMicroとピンヘッダのハンダ付け
1. リセットスイッチのハンダ付け
1. ファームウェアの書き込みと動作確認
1. (オプション)ロータリーエンコーダーのハンダ付け
1. キースイッチのハンダ付け
1. キーキャップの取り付け
1. ゴム足の貼り付け
1. キーマップを変更する

## 1. ダイオードのハンダ付け

基板上に実装するキースイッチを正しく認識させるため、ダイオードを正しい向きでハンダ付けします。  
間違った向きで取り付けると正しく認識できないので、注意してください。  
### 1-1．ダイオードの足を曲げる

**Check:基板は裏返して作業します。**  
**裏側はスイッチの番号やダイオードの番号が書かれた面です。**  

ダイオードには円筒形の素子部分と基板にハンダ付けをする針金状の足部分があります。  
あらかじめ針金状の足部分を曲げておき、後の工程で基板に差し込みやすくしておきます。  
下の画像はダイオードを差し込み、ハンダ付けする部分の拡大図です。  
![Diode-1](imgs/Diode-1.JPG)  
この部分の左右の穴にあわせてダイオードの足を折り曲げておきます。  
![Diode-2](imgs/Diode-2.JPG)  
※一個ずつダイオードの台紙から切り離してから曲げる必要はなく、ダイオードがついている台紙ごと一気に折り曲げても大丈夫です。

### 1-2．基板の穴にダイオードを差し込む

**Check:ダイオードの向きに注意。**  
**ダイオードの向きを間違えると押したキーと違う文字が入力されてしまいます。**  

ダイオードの向きは円筒形の素子に印刷されたラインから判断します。  
![Diode-3](imgs/Diode-3.JPG)  
基板に取り付ける向きは基板の印刷を確認してください。  
`[|◁]`の三角形の向いた先にダイオードのラインが来るように差し込みます。  
![Diode-4](imgs/Diode-4.JPG)  
※Primer16は基板裏側から見た時に、全てのダイオードの左側にラインが来るように向きを揃えています。  

**Point:ダイオードを差し込んだままだとハンダ付けをする際に基板をひっくり返す際に落ちてしまいます。**  
**落ちないようにダイオードの足をちょっと曲げるか、マスキングテープなどで素子を留めて上げると後の工程をスムーズに進める事ができます。**

### 1-3．ダイオードをハンダ付けする

**Check:ハンダごては高温になりますので火傷に注意してください。**  
**Check:基板は表面で作業します。**  

基板をひっくり返して、表面からダイオードの足をハンダ付けします。  
ハンダ付けは、まず基板とダイオードの足をハンダごての先で触れて温め、その1秒後くらいにハンダを温めている部分に送ってハンダ付けをします。  
ハンダを多く送る必要はありません。  
以下の写真のハンダの量、またはYouTubeなどのハンダ付け動画を目安にハンダ付けを行ってください。  
![Diode-7](imgs/Diode-7.JPG)  

**Point:温度調節ができるハンダごてなら320°位がちょうどいいです。**  

### 1-4．余ったダイオードの足をニッパーで切る

**Check:ダイオードの足を切った残りの針金はすぐにまとめてください。**  
**床に落ちたまま放置すると足に刺さります。**  

ダイオードの足をニッパーで切り取ります。  
余裕を持って切る必要はありません。  
基板ギリギリで切り取ってください。  
![Diode-8](imgs/Diode-8.JPG)  

**Check:ここで余裕を持って切ってしまうと使用時に机に傷をつけてしまう場合があります。**

### 1-5．切り取った断面にハンダごてを当てる

ニッパーで切り取っただけでは切断面が尖っている場合があります。  
![Diode-8](imgs/Diode-8.JPG)  
※上の写真では尖っている部分は見えづらいですが、指で触ると尖っていることがわかります。  

もう一度ハンダごてで触れてハンダを溶かすことで切断面が丸まります。  
![Diode-9](imgs/Diode-9.JPG)  
**Point:ハンダごてを当てただけでは丸まらない場合は、ハンダを少量追加すると丸まります。**  

## 2. ProMicroとピンヘッダ/13ピンソケットのハンダ付け

**Check:ProMicroの裏表に十分に注意してください。**  
**逆に取り付けてしまった場合、ピンヘッダを取り外すのはとても大変です。**  

**Check:無線対応をしたい場合、ProMicroの代わりにBLE Micro Proをハンダ付けします。**  
**この場合も裏表に十分注意してください。**  
**後述の「EX2．無線対応」を変わりに参照してください。**  

### 2-1．ピンソケット/ピンヘッダの差し込み

ピンソケットを基板の **表側** から差し込みます。  

![Pinsocket-1](imgs/Pinsocket-1.JPG)  

ピンヘッダの短い方をピンソケットの上に当てます。  
**Check:ピンソケットの一番上のピンを開けておきます。**  
**Point:この時点では奥まで挿さなくても大丈夫です。**  

![Pinsocket-2](imgs/Pinsocket-2.JPG)  

ProMicroをピンヘッダに通します。  
**Check:まだこの時点ではゆるくてOKです。**  
![Pinsocket-3](imgs/Pinsocket-3.JPG)  

ProMicroの両端を持ち、まっすぐ押してピンヘッダをピンソケットに押し込んでいきます。  
横からピンヘッダが見えないことを確認します。  
![Pinsocket-4](imgs/Pinsocket-4.JPG)  

### 2-2．ProMicroの仮止め

ピンヘッダの短い方を基板の **表側** から差し込み、その後ピンヘッダの長い側からProMicroを差し込みます。  

![ProMicro-2](imgs/ProMicro-2.JPG)  

このとき、ProMicroの向きに十分に注意します。  
基板の**表側**からProMicroの**チップ部品が見えるように**なっているはずです。  
後でProMicroのハンダを外すのは大変な労力を伴いますので、ここで**必ず上の写真と相違が無いかチェック**しておきます。

ProMicroとピンヘッダの **一番上だけ** をハンダ付けします。

![ProMicro-3](imgs/ProMicro-3.JPG)  
![ProMicro-4](imgs/ProMicro-4.JPG)  

ProMicroとピンソケットが斜めになっていたり、浮いていたりしないか確認します。  
※もし斜めになっていたり浮いていた場合はもう一度ハンダごてで温めて直してください。

裏側も同様に **一番上だけ** をハンダ付けし、浮いていないか確認します。  
**Point:浮いていたり傾いていた場合はもう一度ハンダごてで温めて直してください。**  

![ProMicro-5](imgs/ProMicro-5.JPG)  
![ProMicro-6](imgs/ProMicro-6.JPG)  

### 2-3．ProMicroのハンダ付け

**Check:ピンヘッダをニッパーで切る際、勢いよく飛んで怪我をする可能性があります。**  

他のピンヘッダの飛び出ている部分をニッパーで切り取ります。  
**Point:ProMicroや基板ギリギリでピンヘッダを切り取ってください。余裕は不要です。**  
**すでにハンダ付けしたピンヘッダも切り取ってください。**  

![ProMicro-7](imgs/ProMicro-7.JPG)  
![ProMicro-8](imgs/ProMicro-8.JPG)  

**Check:ニッパーでそのまま切り取ろうとすると勢いよくピンヘッダの切れ端が飛んでいきます。**  
**飛ぶ際に目に刺さったりすると非常に危険ですし、落ちた切れ端を踏むと刺さります。**  
**必ず飛ばないようにピンヘッダを押さえながら切り取り、作業を中断する際は必ず片付けてください。**

ピンソケットをハンダ付けする。  

![ProMicro-9](imgs/ProMicro-9.JPG)  
![ProMicro-10](imgs/ProMicro-10.JPG)  

**Point:最初にハンダ付けして切り取ったピンヘッダは最後に温めることで丸く綺麗な状態になります。**  

![ProMicro-11](imgs/ProMicro-11.JPG)  

## 3. リセットスイッチのハンダ付け

**Point:リセットスイッチはハンダ付けせずに使うことも出来ます。**  
**使う機会も少ないので、頻繁にファームウェアを書き換える予定がなければハンダ付けを省略しても大丈夫です。**  
**なお、キーマップの書き換えにリセットスイッチは不要です。**  

基板右側、ProMicroの下に`Reset`とある部分にリセットスイッチを表面に取り付け、裏側からハンダ付けします。  

![ResetSW-1](imgs/ResetSW-1.JPG)  
![ResetSW-2](imgs/ResetSW-2.JPG)  

ハンダ付けした後、ニッパーで切り取ってもう一度ハンダごてで温めることで机に傷をつけずに使うことが出来ます。

![ResetSW-3](imgs/ResetSW-3.JPG)  

## 4. ファームウェアの書き込みと動作確認

Primer16はファームウェアとしてqmk_firmwareを使用しています。  
Remapのカタログ機能を用いてファームウェアの書き込みを行います。

※BLE Micro Proの書き込みは本ビルドガイドの末尾の`EX2-3．ファームウェアの書き込み`を参照してください。

https://remap-keys.app/catalog/bxIyrAZHGcJBC9uxH85O/firmware

ファームウェアの書き込みが完了したらRemapのコンフィギュレータ画面を開きます。  

https://remap-keys.app/configure

FLASHをクリックします。

![Remap-1](imgs/Remap-1.png)  

通常のProMicroは「caterina」を、Elite-Cは「dfu」を選択してからFLASHをクリックします。  
※「dfu」を使用しての書き込みは別途Zadigというツールを用いた作業が必要になる場合があります。

![Remap-2](imgs/Remap-2.png)  

下図のように小ウインドウに「Arduino Micro」等が表示されることを確認します。  
表示されない場合、ケーブルや接続するポートを変更して試してみます。

![Remap-6](imgs/Remap-6.png)  

リセットスイッチを押すと一瞬USB機器が抜けたような音がするので先程の小ウインドウのArduino Microのポート番号が変化したことを確認し、素早く「接続」をクリック。  
（本ビルドガイドの図例の場合、COM17がCOM18に変化）  
ポート番号が変化しない場合、リセットを素早く2回実施する等も試してみてください。  

![Remap-7](imgs/Remap-7.png)  

ファームウェアの書き込みが完了したら下図のようにメッセージの最後に「successfully」が表示されます。

![Remap-8](imgs/Remap-8.png)  

ファームウェアの書き込みが完了したらRemapのコンフィギュレータ画面を開きます。  

https://remap-keys.app/configure

Remapで正常に認識できたらテストモードを開き、ピンセットでスイッチ用の穴に触れて導通をチェックします。  

![Remap-3](imgs/Remap-3.png)  
![Remap-4](imgs/Remap-4.JPG)  

**Point:ピンセットがない場合、切り取ったダイオードの足やアルミ箔を切ったものでも代用できます。**  

全て正常だと下図のように全てのキーが青くなります。  
![Remap-5](imgs/Remap-5.png)  

**Point:右上の4キー分はロータリーエンコーダの回転部分です。**  
**この4キー分は青く反応しなくても正常です。**  
**Point:ダイオードの番号とスイッチの番号はリンクしています。**  
**違う部分のキーが反応した場合はダイオードの向きを確認してください。**  
**Point:もし違う部分のキーが反応した場合はスイッチに対応するダイオードの向きを確認してください。**  
**ダイオードの番号とスイッチの番号はリンクしています。**  

## 5. (オプション)ロータリーエンコーダーのハンダ付け

表面からロータリーエンコーダーを取り付けます。  
取付箇所はF11と12キーの部分です。  

机を傷つけないように裏面から飛び出たピンを切ってからハンダ付けをしてください。  
ピンを切る際は余分を残さず、できるだけ根本から切り取ってください。  
![RE-1](imgs/RE-1.JPG)  
![RE-2](imgs/RE-2.JPG)  
![RE-3](imgs/RE-3.JPG)  

**Point:ロータリーエンコーダの横の曲がっている部分は固定用のピンなので、切り取り及びハンダ付けは不要です。**  

## 6. キースイッチのハンダ付け

キースイッチを取り付け、ピンをハンダ付けします。  
机を傷つけないように飛び出たピンを切ってからハンダ付けをしてください。  
**Check:ハンダ付けの前にキースイッチが奥まで差し込まれていることを確認してください。**  

![SW-1](imgs/SW-1.JPG)  
![SW-2](imgs/SW-2.JPG)  
![SW-3](imgs/SW-3.JPG)  

## 7. キーキャップの取り付け

キーキャップを取り付けます。

![completed_assembly_Front](imgs/Completed_assembly_Front.JPG)
![completed_assembly_Back](imgs/Completed_assembly_Back.JPG)

## 8. ゴム足の貼り付け

下の写真を参考に、基板端の八箇所にゴム足を貼り付けます。

![Feet](imgs/Feet.JPG)

## 9. キーマップを変更する

あなたが使用しやすいようにキーマップを変更してください。  
キーマップの変更はRemapを使用すると便利です。

https://remap-keys.app/configure

Remapの使用方法は以下のサイトを参考にしてください。

https://salicylic-acid3.hatenablog.com/entry/remap-manual

## EX2．無線対応

ProMicroの代わりにBLE Micro Proを使うことでBluetoothを用いた無線接続を行う事ができます。  
そのままでもモバイルバッテリー等によるUSB給電を行えますが、BLE Micro Pro用電池基板の部品を用いることで、コイン電池（CR1632）による完全無線を実現することが出来ます。

### EX2-1．BLE Micro Proのハンダ付け

基本的に取付方法はProMicroと同じですが、電池用のピンのために、右側だけ上にオフセットして取り付ける必要があります。  
左側はそのままでもオフセットしても大丈夫です。  
![BMP-1](imgs/BMP-1.JPG)  

### EX2-2．電池部品のハンダ付け

コイン電池ホルダーを表側に装着します。  
ホルダーには向きがあるので注意してください。  
![BMP-2](imgs/BMP-2.JPG)  

裏返してハンダ付けをする際に浮いてしまわないように、マスキングテープなどでホルダーを押さえておきます。

![BMP-3](imgs/BMP-3.JPG)  
![BMP-4](imgs/BMP-4.JPG)  

ショットキーバリアダイオードとチップコンデンサ、スライドスイッチをハンダ付けします。
ショットキーバリアダイオードとチップコンデンサのハンダ付けは表面実装ダイオードの取り付けと同じです。  

まず基板に予備ハンダと呼ばれるハンダをちょっと盛っておきます。  
その後、ピンセットでダイオードやコンデンサを持ち、予備ハンダをハンダごてで溶かしつつダイオードやコンデンサを基板に設置します。  
長く温めすぎてハンダが尖ってしまったら、フラックスを追加してあげるとうまくいきやすいです。
**Point:表面実装ダイオードが不安な場合、練習ゾーンであらかじめ練習しておくと安心です。**  
**電池用のショットキーバリアダイオードとスイッチ用のスイッチングダイオードは異なります。**  
**スイッチングダイオードを電池に使用してしまうと使用できる電池容量の低下を招きます。**  

![BMP-5](imgs/BMP-5.JPG)  

最後にスライドスイッチをハンダ付けします。  
スライドスイッチは下の写真の赤枠部だけ使用しますが、他のピンも固定のために少量ハンダ付けしておきます。

![BMP-6](imgs/BMP-6.JPG)  

**Check:ハンダの量が多いとスイッチの内部にハンダが流れ込み、スイッチが動かなくなる場合があります。**  
**ハンダごてで加熱しすぎるとスイッチのノブが取れやすくなる場合があります。**  

![BMP-7](imgs/BMP-7.jpg)  

### EX2-3．ファームウェアの書き込み

ファームウェアは以下のBLE Micro Pro Web Configuratorから書き込みをしてください。  

https://sekigon-gonnoc.github.io/BLE-Micro-Pro-WebConfigurator/

BLE Micro Pro Web Configuratorの上から順番に実行してください。  
上から順番に実行した後、「キーボードごとの設定を書き込む」ボタンから「Primer16」を選択して書き込んでください。  

![BMP-8](imgs/BMP-8.png)  
![BMP-9](imgs/BMP-9.png)  

書き込み後は「3. リセットスイッチのハンダ付け」と同様の手順となります。  

**Point:Bluetooth接続が不安定、キーマップの書き換えが出来ない、などのBLE Micro Pro特有の問題については[こちら](https://github.com/sekigon-gonnoc/BLE-Micro-Pro/blob/master/docs/FAQ.md)のFAQを確認してください。**  

## EX3．アクリルケースの装着

カットしたアクリルをケースとして用いることで、自由な配色のケースを装着することが出来ます。  
ケースを装着すると剛性が向上し、堅牢かつ良好な打鍵感を体験できます。  

![acrylic_case_assembly_Front](imgs/acrylic_case_assembly_Front.JPG)
![acrylic_case_assembly_Back](imgs/acrylic_case_assembly_Back.JPG)

### EX3-1．ボトムプレートにスペーサーを取り付けてネジ止め

まず本工程で使用する部品を確認します。  
一番底面のプレート(3mm)です。  
![Acrylic-1](imgs/Acrylic-1.png)

基板にすぐ下のプレート(3mm)です。  
部品の干渉を避けるためにフレーム状になっています。  
![Acrylic-2](imgs/Acrylic-2.png)

チルト用の足にするプレート(5mm)です。  
左側にネジ穴が2つ寄るように使います。  
![Acrylic-3](imgs/Acrylic-3.png)

手前側は一番底面のプレート、基板下のプレートを重ね、スペーサーを落とし込んで裏側から5mmのネジで止めます。  
![Acrylic-5](imgs/Acrylic-5.png)

後ろ側はチルト用のプレート、一番底面のプレート、基板下のプレートを重ね、スペーサーを落とし込んで裏側から10mmのネジで止めます。  
![Acrylic-4](imgs/Acrylic-4.png)

### EX3-2．ボトムプレートに基板、トッププレートを取り付けてネジ止め

まず本工程で使用する部品を確認します。  

基板にすぐ上のプレート(5mm)です。  
部品の干渉を避けるためにフレーム状になっています。  
2枚同じものが入っています。  
![Acrylic-6](imgs/Acrylic-6.png)

EX3-1でボトムプレートを重ねたものの上に基板とプレート2種を重ね、12mmのネジで**手前2箇所だけを軽く**ネジ止めをします。  
![Acrylic-7](imgs/Acrylic-7.png)

軽くネジ止めをしたあと、キーキャップを取り付けて実際に押しながら干渉をチェックし、干渉しないことを確認出来たら他のネジも取り付けて増し締めします。  
![Acrylic-8](imgs/Acrylic-8.jpg)

### EX3-3．ProMicroをカバーするプレートを取り付けてネジ止め

まず本工程で使用する部品を確認します。  

基板にすぐ上のプレート(5mm)です。
コイン電池を避けるような形状になっています。  
![Acrylic-9](imgs/Acrylic-9.png)  

無線化しない時用のコイン電池の避けがない形状になっています。  
こちらは2枚入っています。  
![Acrylic-10](imgs/Acrylic-10.png)  

ProMicroをカバーするプレート(3mm)です。  
25mmロータリーエンコーダを避けるような穴が空いています。  
ProMicroを避ける形状のものと、完全にカバーする形状のものの2種類あります。  
![Acrylic-16](imgs/Acrylic-16.png)  
![Acrylic-11](imgs/Acrylic-11.png)

まず基板の上に2枚のプレートを置き、その上にProMicroを避ける形状のプレート、完全にカバーするプレートを順に重ね、18mmのキャップボルト（指で回せるように背が高くなっているボルト）を使って4箇所ネジ止めします。   
![Acrylic-12](imgs/Acrylic-12.png)  
![Acrylic-13](imgs/Acrylic-13.png)  
![Acrylic-14](imgs/Acrylic-14.png)  

### EX3-4．ゴム足を貼り付ける

裏面にゴム足を貼り付けます。  
![Acrylic-15](imgs/Acrylic-15.JPG)
